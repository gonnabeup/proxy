# Cryptoshi Stratum Proxy с Telegram-ботом

Многопользовательский Stratum-прокси с Telegram-ботом для управления майнингом.

## Описание

Данный проект представляет собой многопользовательский Stratum-прокси сервер с интегрированным Telegram-ботом для управления. Система позволяет:

- Создавать отдельные порты для каждого пользователя
- Настраивать различные режимы майнинга (пулы)
- Создавать расписания для автоматического переключения между режимами
- Управлять всеми настройками через удобный Telegram-бот

## Требования

- Python 3.8+
- PostgreSQL
- Доступ к API Telegram

## Установка

Для начала клонируйте репозиторий:
```bash
git clone https://github.com/yourusername/cryptoshi.git
cd cryptoshi
```
### Автоматическая установка (Ubuntu)

Для автоматической установки на Ubuntu выполните:

```bash
cd scripts
chmod +x setup_ubuntu.sh
./setup_ubuntu.sh
```

### Ручная установка

1. Создайте виртуальное окружение:
```bash
python -m venv venv
source venv/bin/activate  # На Windows: venv\Scripts\activate
```

2. Установите зависимости:
```bash
pip install -r requirements.txt
```

3. Настройте базу данных PostgreSQL:
```bash
# Создайте базу данных
createdb cryptoshi
```

4. Настройте конфигурацию:
   - Скопируйте `config/settings.py.example` в `config/settings.py`
   - Отредактируйте настройки базы данных и Telegram-бота

5. Запустите миграции:
```bash
alembic upgrade head
```

## Настройка

### Настройка Telegram-бота

1. Получите токен бота у [@BotFather](https://t.me/BotFather)
2. Добавьте токен в файл `config/settings.py`
3. Укажите ID администраторов в файле `config/settings.py`

### Настройка прокси-сервера

В файле `config/settings.py` настройте:
- Диапазон портов для пользователей
- Настройки логирования
- Другие параметры прокси

## Использование

### Запуск сервера

```bash
python main.py
```

### Команды Telegram-бота

#### Пользовательские команды:

- `/start` - Начать работу с ботом
- `/setlogin` - Задать/изменить логин для воркеров
- `/addmode` - Добавить новый режим пула
- `/modes` - Показать список ваших режимов
- `/setmode` - Выбрать активный режим
- `/schedule` - Управление расписанием
- `/status` - Показать текущий статус
- `/help` - Показать справку

#### Команды администратора:

- `/adduser` - Добавить нового пользователя
- `/setsub` - Установить дату подписки для пользователя
- `/setport` - Назначить порт пользователю
- `/freerange` - Показать свободные порты
- `/listusers` - Показать список всех пользователей

### Подключение майнеров

Для подключения майнеров используйте:
- Хост: IP-адрес сервера
- Порт: Уникальный порт пользователя
- Логин: Логин пользователя
- Пароль: x

## Структура проекта

```
bot2.0/
├── bot/                  # Модули Telegram-бота
│   ├── handlers/         # Обработчики команд
│   ├── keyboards.py      # Клавиатуры для бота
│   └── main.py           # Основной файл бота
├── config/               # Конфигурация
│   └── settings.py       # Настройки приложения
├── db/                   # Работа с базой данных
│   ├── migrations/       # Миграции Alembic
│   └── models.py         # Модели SQLAlchemy
├── proxy/                # Модули Stratum-прокси
│   ├── router.py         # Маршрутизация соединений
│   ├── server.py         # Сервер прокси
│   └── utils.py          # Вспомогательные функции
├── scripts/              # Скрипты для установки и управления
├── main.py               # Точка входа приложения
└── scheduler.py          # Планировщик для расписаний
```

## Устранение неполадок

### Проблемы с подключением к базе данных

Убедитесь, что:
- PostgreSQL запущен
- Настройки подключения в `config/settings.py` корректны
- У пользователя есть права на создание/изменение таблиц

### Проблемы с Telegram-ботом

- Проверьте правильность токена
- Убедитесь, что бот не заблокирован пользователем
- Проверьте логи на наличие ошибок API Telegram

### Проблемы с прокси-сервером

- Убедитесь, что порты не заняты другими приложениями
- Проверьте настройки файрвола
- Проверьте логи на наличие ошибок соединения

## Лицензия

MIT

## Автор

gonnabeup
